<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>验证码验证</title>
</head>
<body>
<h1>验证码验证</h1>
<label for="phone">手机号码：</label>
<input type="text" id="phone" placeholder="请输入手机号码">
<button id="btnsendcode1" onclick="sendPhoneNumber()">获取验证码</button>
<br><br>

<label for="verificationCode">验证码：</label>
<input type="text" id="verificationCode" placeholder="请输入验证码">
<button onclick="verify()">确定</button>

<script>
    var phoneReg = /(^1[3|4|5|7|8]\d{9}$)|(^09\d{8}$)/;  // 手机号正则
    var count = 60;       //间隔所数，1秒执行
    var Intervalobj1;   //timer变量，控制时间
    var curcount1;      //当前剩余秒数
    function SetRemainTime1(){
        if(curcount1 == 0){
            window.clearInterval(Intervalobj1); // 停止计时器
            $("#btnsendcode1").removeAttr("disabled");
            $("#btnSendcode1").val("重新发送");
        }else{
            curcount1--;
        }
    }
    function sendPhoneNumber() {
        curcount1 = count;
        var phoneNumber = document.getElementById("phone").value;
        if (!phoneReg.test(phoneNumber)) {
            alert("请输入有效的手机号码");
            return false;
        }
        //设置button效果，开始计时
        // 向后台发送处理数据
        // 模拟发送手机号码的请求
        // 在这里调用你的API发送手机号码的逻辑
        console.log("发送手机号码：" + phoneNumber);
        // 这里你可以调用后端接口发送手机号码
        // 构建要发送的数据对象
        const params = new URLSearchParams();
        params.append('phoneNumber', phoneNumber);
        // 发送 Get 请求到后端验证
        fetch("http://localhost:8080/getValidateCode?" + params.toString(), {
            method: "GET",
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
			if (response.ok) {
				return response.text();
			} else {
				throw new Error('获取验证码失败');
			}
		}).then(data => {
			// 在这里处理后端响应
			console.log(data);   //  输出后端返回的数据到控制台
			alert(data); // 根据后端返回的数据进行相应处理，这里假设后端返回一个包含 message 属性的 JSON 对象
		}).catch(error => {
			console.error('发生错误:', error);
			alert('获取失败，请重试');
		});
    }

    function verify() {
        var phoneNumber = document.getElementById("phone").value;
        var verificationCode = document.getElementById("verificationCode").value;
        // 模拟发送手机号码和验证码的请求
        // 在这里调用你的API验证手机号码和验证码的逻辑
        console.log("手机号码：" + phoneNumber + "，验证码：" + verificationCode);
        // 这里你可以调用后端接口验证手机号码和验证码
        // 构建要发送的数据对象
        const params = new URLSearchParams();
        params.append('phoneNumber', phoneNumber);
        params.append('phoneCode', verificationCode);
        // 发送 Get 请求到后端验证
        fetch("http://localhost:8080/validate?" + params.toString(), {
            method: "GET",
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.ok) {
                return response.text();
            } else {
                throw new Error('验证失败，请先获取验证码');
            }
        }).then(data => {
            // 在这里处理后端响应
            console.log(data);   //  输出后端返回的数据到控制台
            alert(data); // 根据后端返回的数据进行相应处理，这里假设后端返回一个包含 message 属性的 JSON 对象
        }).catch(error => {
            console.error('发生错误:', error);
            alert('验证失败，请先获取验证码');
        });
    }
</script>
</body>
</html>
